<!DOCTYPE html>
<html>
  <head>
    <title>Sunset map</title>

    <script type="text/javascript" src="js/src/core.js"></script>
    <script type="text/javascript" src="js/src/settings.js"></script>
    <script type="text/javascript" src="js/src/mercator.js"></script>
    <script type="text/javascript" src="js/src/geometry.js"></script>
    <script type="text/javascript" src="js/src/model.js"></script>
    <script type="text/javascript" src="js/src/renderer.js"></script>
    <script type="text/javascript" src="js/src/shader.js"></script>

    <script type="text/javascript" src="js/src/cartodb.sql.js"></script>
    <script type="text/javascript" src="js/src/cartodb.provider.js"></script>

    <!-- carto -->
    <script src='libs/underscore.js' type='text/javascript'></script>
    <script src='libs/carto.js' type='text/javascript'></script>

    <script type="text/javascript" src="libs/suncalc.js"></script>
    <script type="text/javascript" src="libs/modestmaps.js"></script>
    <script type="text/javascript" src="js/src/vecnik.modestmaps.js"></script>

    <script type="text/javascript" src="js/src/carto.js"></script>
    <script type="text/javascript" src="js/src/app.js"></script>

    <link rel="stylesheet" href="css/today.css" />

    <style>
    </style>
  </head>
  <body>
    <div id="map"></div>
    <!--<div id="livecode" class="highlight">-->
    </div>
    <a href='#' class="button" id="start_animation">start animation</a>
    <div class="tod" id="tod"></div>
    <input name='user' id='user' value='viz2' />
    <input name='tablename' id='tn' value='ny' />
    <script src="http://libs.cartocdn.com/cartodb.js/v2/cartodb.js"></script>
    <script>
      initMap('ny');
      $('#tn').change(function(t){
        var sql = new cartodb.SQL({ user: $("#user").val()});
        var table = $(this).val();
        sql.execute("SELECT ST_X(geom) x, ST_Y(geom) y FROM (SELECT ST_Centroid(ST_Envelope(ST_Collect(the_geom))) geom FROM {{table_name}}) a", {table_name: table})
        .done(function(json) {
          console.log(json.rows[0])
          initMap(table)
          map.setCenterZoom(new MM.Location(json.rows[0].y, json.rows[0].x), 13);
        })
      })
    </script>
  </body>
</html>

